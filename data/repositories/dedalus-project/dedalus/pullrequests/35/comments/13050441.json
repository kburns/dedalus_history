{"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/pullrequests/35/comments/13050441.json"}, "html": {"href": "#!/dedalus-project/dedalus/pull-requests/35/_/diff#comment-13050441"}}, "parent": {"id": 12481777, "links": {"self": {"href": "data/repositories/dedalus-project/dedalus/pullrequests/35/comments/12481777.json"}, "html": {"href": "#!/dedalus-project/dedalus/pull-requests/35/_/diff#comment-12481777"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 35, "links": {"self": {"href": "data/repositories/dedalus-project/dedalus/pullrequests/35.json"}, "html": {"href": "#!/dedalus-project/dedalus/pull-requests/35"}}, "title": "Simple Checkpointing mechanism"}, "content": {"raw": "it's this line (363 of evaluator.py) that seems to be the source of the problem:\n\n#!/dedalus-project/dedalus/pull-requests/35/simple-checkpointing-mechanism/diff#Ldedalus/core/evaluator.pyT363\n\nComment this out and we get the normal behaviour, where max_writes is respected, and `self.file_write_num` stays bounded between 1 and `self.max_writes`.  \n\nLeave it in and then writes continue to increment past `self.max_writes`, thereby failing to trigger the write num check at line #!/dedalus-project/dedalus/pull-requests/35/simple-checkpointing-mechanism/diff#Ldedalus/core/evaluator.pyF332T337 \n\nOne solution is to throw a mod statement in, possibly at the assignment statement.  This for example seems to work as a replacement for line 363:\n\n\n```\n#!python\n\nself.file_write_num = h5file['/scales/write_number'][-1] % self.max_writes\n```\n", "markup": "markdown", "html": "<p>it's this line (363 of evaluator.py) that seems to be the source of the problem:</p>\n<p><a href=\"#!/dedalus-project/dedalus/pull-requests/35/simple-checkpointing-mechanism/diff#Ldedalus/core/evaluator.pyT363\" rel=\"nofollow\" class=\"ap-connect-link\">#!/dedalus-project/dedalus/pull-requests/35/simple-checkpointing-mechanism/diff#Ldedalus/core/evaluator.pyT363</a></p>\n<p>Comment this out and we get the normal behaviour, where max_writes is respected, and <code>self.file_write_num</code> stays bounded between 1 and <code>self.max_writes</code>.  </p>\n<p>Leave it in and then writes continue to increment past <code>self.max_writes</code>, thereby failing to trigger the write num check at line <a href=\"#!/dedalus-project/dedalus/pull-requests/35/simple-checkpointing-mechanism/diff#Ldedalus/core/evaluator.pyF332T337\" rel=\"nofollow\" class=\"ap-connect-link\">#!/dedalus-project/dedalus/pull-requests/35/simple-checkpointing-mechanism/diff#Ldedalus/core/evaluator.pyF332T337</a> </p>\n<p>One solution is to throw a mod statement in, possibly at the assignment statement.  This for example seems to work as a replacement for line 363:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file_write_num</span> <span class=\"o\">=</span> <span class=\"n\">h5file</span><span class=\"p\">[</span><span class=\"s1\">&#39;/scales/write_number&#39;</span><span class=\"p\">][</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">%</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">max_writes</span>\n</pre></div>", "type": "rendered"}, "created_on": "2015-12-28T04:49:27.236959+00:00", "user": {"display_name": "Benjamin Brown", "uuid": "{7ccecdb3-3639-4001-8249-060e80320bda}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B7ccecdb3-3639-4001-8249-060e80320bda%7D"}, "html": {"href": "https://bitbucket.org/%7B7ccecdb3-3639-4001-8249-060e80320bda%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:0696c4b9-e94c-41ac-82be-62ad4f0ec571/8bc6f4da-871a-48b1-88ea-998663d18142/128"}}, "nickname": "Benjamin Brown", "type": "user", "account_id": "557058:0696c4b9-e94c-41ac-82be-62ad4f0ec571"}, "updated_on": "2015-12-28T04:49:27.239439+00:00", "type": "pullrequest_comment", "id": 13050441}