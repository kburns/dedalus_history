{"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/59/comments/52553772.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/59#comment-52553772"}}, "issue": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/59.json"}}, "type": "issue", "id": 59, "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "title": "IVPs fail when output tasks include redundant substitutions"}, "content": {"raw": "When defining substitutions that have the square of a field quantity, as in,\r\n\r\n```\r\nproblem.substitutions['square_sub'] = '(w)**2'\r\n```\r\n\r\nIf you try to output that substitution\u2019s data in BOTH coefficient and grid space,\r\n\r\n```\r\nslices = solver.evaluator.add_file_handler('slices', sim_dt=0.25, max_writes=50)\r\ncoeffs = solver.evaluator.add_file_handler('coeffs', sim_dt=0.25, max_writes=50)\r\nslices.add_task('square_sub')\r\ncoeffs.add_task('square_sub', layout='c')\r\n```\r\n\r\nThe run fails with a \u201cValueError: gdata does not match scaled grid\\_size\u201d before any timesteps can occur. I\u2019ve attached a minorly modified rayleigh\\_benard.py file from the dedalus examples \\(my changes are lines 48 and 98-102 of the attached file\\)  that reproduces this error, and an text file containing the simulation output and full traceback.\r\n\r\nA similar bug has appeared on numerous devices within our research group, so this doesn\u2019t seem to be isolated to my computer.", "markup": "markdown", "html": "<p>When defining substitutions that have the square of a field quantity, as in,</p>\n<div class=\"codehilite\"><pre><span></span>problem.substitutions[&#39;square_sub&#39;] = &#39;(w)**2&#39;\n</pre></div>\n\n\n<p>If you try to output that substitution\u2019s data in BOTH coefficient and grid space,</p>\n<div class=\"codehilite\"><pre><span></span>slices = solver.evaluator.add_file_handler(&#39;slices&#39;, sim_dt=0.25, max_writes=50)\ncoeffs = solver.evaluator.add_file_handler(&#39;coeffs&#39;, sim_dt=0.25, max_writes=50)\nslices.add_task(&#39;square_sub&#39;)\ncoeffs.add_task(&#39;square_sub&#39;, layout=&#39;c&#39;)\n</pre></div>\n\n\n<p>The run fails with a \u201cValueError: gdata does not match scaled grid_size\u201d before any timesteps can occur. I\u2019ve attached a minorly modified rayleigh_benard.py file from the dedalus examples (my changes are lines 48 and 98-102 of the attached file)  that reproduces this error, and an text file containing the simulation output and full traceback.</p>\n<p>A similar bug has appeared on numerous devices within our research group, so this doesn\u2019t seem to be isolated to my computer.</p>", "type": "rendered"}, "created_on": "2019-06-12T17:31:02.448090+00:00", "user": {"display_name": "Keaton Burns", "uuid": "{3d3e64f1-bf12-45df-b655-4543d8fb34c4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d3e64f1-bf12-45df-b655-4543d8fb34c4%7D"}, "html": {"href": "https://bitbucket.org/%7B3d3e64f1-bf12-45df-b655-4543d8fb34c4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:e31a7835-5317-4dfa-8551-f32a06f40279/40f33f99-2b75-4a17-a8c2-07c8d74c7480/128"}}, "nickname": "kburns", "type": "user", "account_id": "557058:e31a7835-5317-4dfa-8551-f32a06f40279"}, "updated_on": null, "type": "issue_comment", "id": 52553772}