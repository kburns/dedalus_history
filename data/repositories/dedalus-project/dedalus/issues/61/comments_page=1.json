{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61/comments/52553864.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/61#comment-52553864"}}, "issue": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61.json"}}, "type": "issue", "id": 61, "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "title": "Eigenvalue problems extremely slow using default conda install"}, "content": {"raw": "Can you try the conda build using MKL to see if that makes a difference?  Also it looks like conda-forge has been changing how it handles BLAS recently, so we\u2019ll probably want to revisit the current openblas vs MKL settings in our conda script once that settles down \\(e.g. I think the conda-forge numpy can now use MKL?\\).\n\n[https://github.com/conda-forge/numpy-feedstock/issues/108](https://github.com/conda-forge/numpy-feedstock/issues/108)\n\n[https://github.com/conda-forge/numpy-feedstock/issues/153](https://github.com/conda-forge/numpy-feedstock/issues/153)", "markup": "markdown", "html": "<p>Can you try the conda build using MKL to see if that makes a difference?  Also it looks like conda-forge has been changing how it handles BLAS recently, so we\u2019ll probably want to revisit the current openblas vs MKL settings in our conda script once that settles down (e.g. I think the conda-forge numpy can now use MKL?).</p>\n<p><a data-is-external-link=\"true\" href=\"https://github.com/conda-forge/numpy-feedstock/issues/108\" rel=\"nofollow\">https://github.com/conda-forge/numpy-feedstock/issues/108</a></p>\n<p><a data-is-external-link=\"true\" href=\"https://github.com/conda-forge/numpy-feedstock/issues/153\" rel=\"nofollow\">https://github.com/conda-forge/numpy-feedstock/issues/153</a></p>", "type": "rendered"}, "created_on": "2019-06-12T17:38:47.251299+00:00", "user": {"display_name": "Keaton Burns", "uuid": "{3d3e64f1-bf12-45df-b655-4543d8fb34c4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d3e64f1-bf12-45df-b655-4543d8fb34c4%7D"}, "html": {"href": "https://bitbucket.org/%7B3d3e64f1-bf12-45df-b655-4543d8fb34c4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:e31a7835-5317-4dfa-8551-f32a06f40279/40f33f99-2b75-4a17-a8c2-07c8d74c7480/128"}}, "nickname": "kburns", "type": "user", "account_id": "557058:e31a7835-5317-4dfa-8551-f32a06f40279"}, "updated_on": null, "type": "issue_comment", "id": 52553864}, {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61/comments/52554009.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/61#comment-52554009"}}, "issue": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61.json"}}, "type": "issue", "id": 61, "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "title": "Eigenvalue problems extremely slow using default conda install"}, "content": {"raw": "Yes, that\u2019s the plan!", "markup": "markdown", "html": "<p>Yes, that\u2019s the plan!</p>", "type": "rendered"}, "created_on": "2019-06-12T17:52:31.820314+00:00", "user": {"display_name": "J. S. Oishi", "uuid": "{ab7c2db2-7642-47a8-9264-0939f601d904}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D"}, "html": {"href": "https://bitbucket.org/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:94f96ca9-adbd-4972-8f41-b00b9683f819/4a90742a-28a5-4829-a074-c23c9f5fcc81/128"}}, "nickname": "jsoishi", "type": "user", "account_id": "557058:94f96ca9-adbd-4972-8f41-b00b9683f819"}, "updated_on": null, "type": "issue_comment", "id": 52554009}, {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61/comments/52554012.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/61#comment-52554012"}}, "issue": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61.json"}}, "type": "issue", "id": 61, "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "title": "Eigenvalue problems extremely slow using default conda install"}, "content": {"raw": "The default conda installation method leads to extremely slow Eigenvalue problems. On the Bates College Leavitt cluster, a comparison between an older, install-script installation leads to the following:\r\n\r\n## 1D Rayleigh-Benard Eigenvalue example\r\n\r\n* conda install: 32 sec\r\n* install script: 3.2 sec\r\n\r\nInterestingly, the IVPs are not nearly as affected. \r\n\r\n## 3D Rayleigh-Benard Initial Value example\r\n\r\n* conda install: 949 sec\r\n* install script: 879 sec\r\n\r\nI have tried even more difficult eigenvalue problems, and the problem becomes even worse as the startup costs get pushed down. \r\n\r\nI used cProfile to note that the biggest difference, accounting for nearly all of the eigenvalue differential is `arpack.py` from the scipy sparse linear algebra package.\r\n\r\nBy using `objdump -x \"_arpack.cpython-37m-x86_64-linux-gnu.so\" | grep NEEDED` on the two versions of `_arpack.cpython-37m-x86_64-linux-gnu.so`, it appears as though the difference is that conda uses openblas, while my install script installation used atlas. While this has a minor difference \\(~10% or so\\) for IVPs, for eigenvalue problems, it appears to be devastating  \\(10-16x in my tests!\\).", "markup": "markdown", "html": "<p>The default conda installation method leads to extremely slow Eigenvalue problems. On the Bates College Leavitt cluster, a comparison between an older, install-script installation leads to the following:</p>\n<h2 id=\"markdown-header-1d-rayleigh-benard-eigenvalue-example\">1D Rayleigh-Benard Eigenvalue example</h2>\n<ul>\n<li>conda install: 32 sec</li>\n<li>install script: 3.2 sec</li>\n</ul>\n<p>Interestingly, the IVPs are not nearly as affected. </p>\n<h2 id=\"markdown-header-3d-rayleigh-benard-initial-value-example\">3D Rayleigh-Benard Initial Value example</h2>\n<ul>\n<li>conda install: 949 sec</li>\n<li>install script: 879 sec</li>\n</ul>\n<p>I have tried even more difficult eigenvalue problems, and the problem becomes even worse as the startup costs get pushed down. </p>\n<p>I used cProfile to note that the biggest difference, accounting for nearly all of the eigenvalue differential is <code>arpack.py</code> from the scipy sparse linear algebra package.</p>\n<p>By using <code>objdump -x \"_arpack.cpython-37m-x86_64-linux-gnu.so\" | grep NEEDED</code> on the two versions of <code>_arpack.cpython-37m-x86_64-linux-gnu.so</code>, it appears as though the difference is that conda uses openblas, while my install script installation used atlas. While this has a minor difference (~10% or so) for IVPs, for eigenvalue problems, it appears to be devastating  (10-16x in my tests!).</p>", "type": "rendered"}, "created_on": "2019-06-12T17:52:48.395394+00:00", "user": {"display_name": "J. S. Oishi", "uuid": "{ab7c2db2-7642-47a8-9264-0939f601d904}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D"}, "html": {"href": "https://bitbucket.org/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:94f96ca9-adbd-4972-8f41-b00b9683f819/4a90742a-28a5-4829-a074-c23c9f5fcc81/128"}}, "nickname": "jsoishi", "type": "user", "account_id": "557058:94f96ca9-adbd-4972-8f41-b00b9683f819"}, "updated_on": null, "type": "issue_comment", "id": 52554012}, {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61/comments/52948634.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/61#comment-52948634"}}, "issue": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61.json"}}, "type": "issue", "id": 61, "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "title": "Eigenvalue problems extremely slow using default conda install"}, "content": {"raw": "A random thought \u2013 I\u2019ve seen some big performance hits on some stacks due to numpy/scipy apparently trying to use multiple threads inside some matrix routines.  Maybe it\u2019s worth explicitly setting OMP\\_NUM\\_THREADS=1 or similar to be sure that isn\u2019t happening here for any of the stacks?", "markup": "markdown", "html": "<p>A random thought \u2013 I\u2019ve seen some big performance hits on some stacks due to numpy/scipy apparently trying to use multiple threads inside some matrix routines.  Maybe it\u2019s worth explicitly setting OMP_NUM_THREADS=1 or similar to be sure that isn\u2019t happening here for any of the stacks?</p>", "type": "rendered"}, "created_on": "2019-07-11T18:57:17.009068+00:00", "user": {"display_name": "Keaton Burns", "uuid": "{3d3e64f1-bf12-45df-b655-4543d8fb34c4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d3e64f1-bf12-45df-b655-4543d8fb34c4%7D"}, "html": {"href": "https://bitbucket.org/%7B3d3e64f1-bf12-45df-b655-4543d8fb34c4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:e31a7835-5317-4dfa-8551-f32a06f40279/40f33f99-2b75-4a17-a8c2-07c8d74c7480/128"}}, "nickname": "kburns", "type": "user", "account_id": "557058:e31a7835-5317-4dfa-8551-f32a06f40279"}, "updated_on": null, "type": "issue_comment", "id": 52948634}, {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61/comments/52949739.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/61#comment-52949739"}}, "issue": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61.json"}}, "type": "issue", "id": 61, "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "title": "Eigenvalue problems extremely slow using default conda install"}, "content": {"raw": "@{557058:e31a7835-5317-4dfa-8551-f32a06f40279}  that was it! OMP\\_NUM\\_THREADS=1 gives 2.99 sec with conda! It would appear that the issue is that the atlas library is not OpenMP\u2019d.", "markup": "markdown", "html": "<p><span class=\"ap-mention ap-mention-me\" data-atlassian-id=\"557058:e31a7835-5317-4dfa-8551-f32a06f40279\">@Keaton Burns</span>  that was it! OMP_NUM_THREADS=1 gives 2.99 sec with conda! It would appear that the issue is that the atlas library is not OpenMP\u2019d.</p>", "type": "rendered"}, "created_on": "2019-07-11T20:46:36.661861+00:00", "user": {"display_name": "J. S. Oishi", "uuid": "{ab7c2db2-7642-47a8-9264-0939f601d904}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D"}, "html": {"href": "https://bitbucket.org/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:94f96ca9-adbd-4972-8f41-b00b9683f819/4a90742a-28a5-4829-a074-c23c9f5fcc81/128"}}, "nickname": "jsoishi", "type": "user", "account_id": "557058:94f96ca9-adbd-4972-8f41-b00b9683f819"}, "updated_on": null, "type": "issue_comment", "id": 52949739}, {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61/comments/52949744.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/61#comment-52949744"}}, "issue": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus/issues/61.json"}}, "type": "issue", "id": 61, "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "title": "Eigenvalue problems extremely slow using default conda install"}, "content": {"raw": "The problem is that conda install seems to use multiple OpenMP threads, leading to a massive slowdown in performance.", "markup": "markdown", "html": "<p>The problem is that conda install seems to use multiple OpenMP threads, leading to a massive slowdown in performance.</p>", "type": "rendered"}, "created_on": "2019-07-11T20:47:47.172509+00:00", "user": {"display_name": "J. S. Oishi", "uuid": "{ab7c2db2-7642-47a8-9264-0939f601d904}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D"}, "html": {"href": "https://bitbucket.org/%7Bab7c2db2-7642-47a8-9264-0939f601d904%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:94f96ca9-adbd-4972-8f41-b00b9683f819/4a90742a-28a5-4829-a074-c23c9f5fcc81/128"}}, "nickname": "jsoishi", "type": "user", "account_id": "557058:94f96ca9-adbd-4972-8f41-b00b9683f819"}, "updated_on": null, "type": "issue_comment", "id": 52949744}], "page": 1, "size": 6}