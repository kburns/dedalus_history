{"priority": "trivial", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/dedalus-project/dedalus.json"}, "html": {"href": "#!/dedalus-project/dedalus"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dc39ab6-2798-450d-af2f-e976f94b5794}ts=2009435"}}, "type": "repository", "name": "dedalus", "full_name": "dedalus-project/dedalus", "uuid": "{1dc39ab6-2798-450d-af2f-e976f94b5794}"}, "links": {"attachments": {"href": "data/repositories/dedalus-project/dedalus/issues/47/attachments_page=1.json"}, "self": {"href": "data/repositories/dedalus-project/dedalus/issues/47.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/dedalus-project/dedalus/issues/47/watch"}, "comments": {"href": "data/repositories/dedalus-project/dedalus/issues/47/comments_page=1.json"}, "html": {"href": "#!/dedalus-project/dedalus/issues/47/replace-use-of-absolute-with-resolve-in"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/dedalus-project/dedalus/issues/47/vote"}}, "reporter": {"display_name": "Jacob Wenegrat", "uuid": "{8f6f5c41-b46a-4a93-abd6-fefac1906b33}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B8f6f5c41-b46a-4a93-abd6-fefac1906b33%7D"}, "html": {"href": "https://bitbucket.org/%7B8f6f5c41-b46a-4a93-abd6-fefac1906b33%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9e9af7669a822614a39433db4d409b22d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJW-2.png"}}, "nickname": "wenegrat", "type": "user", "account_id": "5c66f613f3071d5706239d17"}, "title": "Replace use of absolute() with resolve() in FileHandler", "component": null, "votes": 0, "watches": 1, "content": {"raw": "On line 329 of evaluator.py the supplied base_path is converted to an absolute path using:\r\n base_path = pathlib.Path(base_path).absolute()\r\n\r\nNote however that absolute() may not be very well tested: https://bugs.python.org/issue29688, and regardless does not do as complete a normalization as might be required: https://github.com/python/cpython/blob/355f16fd4beb36d6a18f7d0982581c93de015c17/Lib/pathlib.py#L1118\r\n\r\nInstead a better option is pathlib.Path.resolve() \r\nhttps://github.com/python/cpython/blob/355f16fd4beb36d6a18f7d0982581c93de015c17/Lib/pathlib.py#L1136\r\n\r\nThis change is motivated by problems I have had running across multiple cores on beegfs filesystems (as documented here: https://groups.google.com/forum/#!topic/dedalus-users/Bj4Ax7bFUcI). Switching absolute() to resolve() on line 329 of evaluator.py appears to have fixed these filesystem errors for me.\r\n\r\nJacob", "markup": "markdown", "html": "<p>On line 329 of evaluator.py the supplied base_path is converted to an absolute path using:\n base_path = pathlib.Path(base_path).absolute()</p>\n<p>Note however that absolute() may not be very well tested: <a href=\"https://bugs.python.org/issue29688\" rel=\"nofollow\" class=\"ap-connect-link\">https://bugs.python.org/issue29688</a>, and regardless does not do as complete a normalization as might be required: <a href=\"https://github.com/python/cpython/blob/355f16fd4beb36d6a18f7d0982581c93de015c17/Lib/pathlib.py#L1118\" rel=\"nofollow\" class=\"ap-connect-link\">https://github.com/python/cpython/blob/355f16fd4beb36d6a18f7d0982581c93de015c17/Lib/pathlib.py#L1118</a></p>\n<p>Instead a better option is pathlib.Path.resolve() \n<a href=\"https://github.com/python/cpython/blob/355f16fd4beb36d6a18f7d0982581c93de015c17/Lib/pathlib.py#L1136\" rel=\"nofollow\" class=\"ap-connect-link\">https://github.com/python/cpython/blob/355f16fd4beb36d6a18f7d0982581c93de015c17/Lib/pathlib.py#L1136</a></p>\n<p>This change is motivated by problems I have had running across multiple cores on beegfs filesystems (as documented here: <a href=\"https://groups.google.com/forum/#!topic/dedalus-users/Bj4Ax7bFUcI\" rel=\"nofollow\" class=\"ap-connect-link\">https://groups.google.com/forum/#!topic/dedalus-users/Bj4Ax7bFUcI</a>). Switching absolute() to resolve() on line 329 of evaluator.py appears to have fixed these filesystem errors for me.</p>\n<p>Jacob</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2019-02-15T17:42:53.831670+00:00", "milestone": null, "updated_on": "2019-02-18T20:35:37.651063+00:00", "type": "issue", "id": 47}